<html>
  <head>
<style>
  #body{
    background-color: slategrey;
    display: flex;
    flex-direction: column;
    align-content: center;
  }
  #NavBar{
    background-color: lightgrey;
    border-radius: 15px
  }
  .center{
  }
  .spread{
    display:flex;
    justify-content: space-around
  }
  .SingleStudent{
    display: flex;
    align-content: space-around;
    flex-direction: column
  }
  #EnrollStudent{
    display: flex;
    align-content: space-around;
    flex-direction: column;
    align-items: center;
    width: 200px;
    background-color: lightgrey;
    border-radius: 15px
  }
</style>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js'></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.0/react-router-dom.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.1/redux.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/react-redux/7.1.0/react-redux.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/redux-thunk/2.3.0/redux-thunk.js'></script>
  </head>
  <body id='body'>
    <div id='root'></div>
    <script type='text/babel'>
      const { HashRouter, NavLink, Route } = ReactRouterDOM;
      const { Provider, connect} = ReactRedux;
      const { applyMiddleware } = Redux;

// STORE BELOW
      const SET_STUDENTS = 'SET_STUDENTS';
      const ADD_STUDENT = 'ADD_STUDENT';
      const DEL_STUDENT = 'DEL_STUDENT';
      const SET_SCHOOLS = 'SET_SCHOOLS'
      const ENROLL_STUDENT = 'ENROLL_STUDENT';
      const WITHDRAW_STUDENT = 'WITHDRAW_STUDENT';

      const setStudents = (_students) => (
        {
          type: SET_STUDENTS,
          students: _students
        }
      )
      const addStudent= (_student) => (
        {
          type: ADD_STUDENT,
          student: _student
        }
      );
      const delStudent = (_student) => (
        {
          type: DEL_STUDENT,
          id: _student.id
        }
      );
      const setSchools = (_schools) => (
        {
          type: SET_SCHOOLS,
          schools: _schools
        }
      )
      // v TO WORK ON -NOT SURE WHAT TO RETURNv
      const enrollStudent = (_student, _school) => (
        {
          type: ENROLL_STUDENT,
          student: _student,
          school: _school
        }
      );
      const withdrawStudent = (_student) => (
        {
          type: WITHDRAW_STUDENT,
          student: _student
        }
      );

      const store = Redux.createStore((state = {schools: [], students: []}, action ) => {
        switch(action.type){
          case 'SET_STUDENTS':
            return {
              ...state,
              students: action.students
            }
          case 'ADD_STUDENT':
            return {
              ...state,
              students: [...state.students, student]
            }
            break;
          case 'DEL_STUDENT':
            return {
              ...state,
              students: state.students.filter( (student) => student.id !== action.id)
            }
            break;
          case 'SET_SCHOOLS':
            return {
              ...state,
              schools: action.schools
            }
            break;
          case 'ENROLL_STUDENT':
            break;
          case 'WITHDRAW_STUDENT':
            break;
          default:
            return state
        }
      },applyMiddleware(ReduxThunk.default));

      const getStudents = () => {
        return async (dispatch) => {
          const replyStudents = await axios.get('/api/students')
          dispatch(setStudents(replyStudents.data))
        }
      };
      const getSchools = () => {
        return async (dispatch) => {
          const replySchools = await axios.get('/api/schools')
          dispatch(setSchools(replySchools.data))
        }
      };

      // const start = async() => {
      //   const replySchools = await axios.get('/api/schools')
      //   store.dispatch({
      //     type:'SET_SCHOOLS',
      //     schools: replySchools.data
      //   })
      // };
      // start()
// STORE ABOVE

//REACT BELOW
      class App extends React.Component {
        constructor(){
          super()
        };
        componentDidMount(){
          this.props.getStudents()
          this.props.getSchools()
        };
        componentWillUnmount(){
        };
        render() {
          return(

              <HashRouter>
                <h1>Acme Schools</h1>
                <Nav/>
                <br/>
                <Route exact path='/' component={Home}/>
                <Route path='/schools' component={Schools}/>
                <Route path='/students' component={_Students} />
              </HashRouter>
          )
        }
      };
      const _App = connect(
        null,
        (dispatch)=> ({
          getStudents: () => dispatch(getStudents()),
          getSchools: () => dispatch(getSchools())
        })
      )(App)

      const Nav = () => {
        return(
          <div id='NavBar'>
            <div className='spread' >
              <NavLink to='/'>Home</NavLink>
              <NavLink to='/schools'>Schools</NavLink>
              <NavLink to='/students'>Students</NavLink>
            </div>
          </div>
        )
      };
      const Home = () => {
        return(
          <div>
            <h2>Home Page</h2>
            <div>Most Popular School</div>
            <div>Highest Performing School</div>
          </div>
        )
      };

      const Schools = () => {
        return(
          <div>
            <div className='spread'>
              <img src='https://vignette.wikia.nocookie.net/memoryalpha/images/1/18/Starfleet_Academy_logo_2368.png/revision/latest?cb=20060912110311&path-prefix=en' height='150'/>
              <img src='https://cdn-payscale.com/content/school_logos/Pratt%20Institute_200px.png' height='150'/>
              <img src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT_pMw9Sru_aQUy2Rg8tdh_NjSaeW1aBVYxcU0earWX17MPuhNU' height='150'/>
            </div>
          </div>
        )
      }
      class Students extends React.Component{
        constructor(props){
          super(props)
          const state = {
            firstName:'',
            lastName:'',
            email:'',
            GPA:null,
            schoolId:null
          }
        };
        componentDidMount() {
          console.log(this.props)
          console.log(store.getState().schools)
        };
        render(){
          return(
            <div className='center'>
              <form id='EnrollStudent'>
                <h3>Enroll New Student</h3>
                <label>First Name</label>
                  <input/>
                <label>Last Name</label>
                  <input/>
                <label>Email</label>
                  <input/>
                <label>Current GPA</label>
                  <input/>
                <select>
                  {store.getState().schools.map( (school) => {
                    return(
                      <option>{school.name} </option>
                    )
                  })}
                </select>
                <button type='submit'>Enroll</button>
              </form>
              <hr/>
              <div>
                <h3>Enrolled Students</h3>
                {store.getState().students.map( (student) => {
                  return(
                    <div key={student.id} className='SingleStudent'>
                      <h4>{student.firstName}</h4>
                      <div> GPA: {student.GPA} </div>
                      <select defaultOption='switch'>
                        {store.getState().schools.map( (school) => {
                          return(
                            <option key={school.id}> {school.name} </option>
                          )
                        })}
                      </select>
                    </div>
                  )
                })}
              </div>
            </div>
          )
        }
      };
      const _Students = connect(
        null,
        (dispatch)=> ({
          getStudents: () => dispatch(getStudents()),
          getSchools: () => dispatch(getSchools())
        })
      )(Students)

      const root = document.querySelector('#root');
      ReactDOM.render(
        <Provider store={store}>
          <_App/>
        </Provider>
        , root);

    </script>
  </body>
</html>
